<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR Chemical Mixing ‚Äì Visible Liquids Guaranteed</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <!-- AR.js -->
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
      background: black;
    }
    #hud {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.95);
      color: white;
      padding: 15px;
      border-radius: 10px;
      z-index: 1000;
      max-width: 85%;
      border: 2px solid #0088ff;
    }
    .debug {
      position: absolute;
      bottom: 10px;
      left: 10px;
      background: rgba(255,0,0,0.8);
      color: white;
      padding: 10px;
      border-radius: 5px;
      z-index: 1000;
      font-size: 12px;
    }
  </style>

  <script>
    // EXTREMELY SIMPLE STATE
    let tubeAVisible = false;
    let tubeBVisible = false;
    
    // Force liquids to be visible
    function forceLiquidsVisible() {
      console.log("=== FORCING LIQUIDS VISIBLE ===");
      
      // BLUE LIQUID
      let liquidA = document.querySelector("#liquidA");
      let surfaceA = document.querySelector("#surfaceA");
      
      if (!liquidA) {
        console.log("Creating blue liquid...");
        liquidA = document.createElement("a-cylinder");
        liquidA.setAttribute("id", "liquidA");
        liquidA.setAttribute("radius", "0.13");
        liquidA.setAttribute("height", "0.28");
        liquidA.setAttribute("position", "0 0.14 0");
        liquidA.setAttribute("color", "#0088ff");
        liquidA.setAttribute("opacity", "0.95");
        liquidA.setAttribute("visible", "true");
        
        const tubeA = document.querySelector("#tubeA");
        if (tubeA) {
          tubeA.appendChild(liquidA);
          console.log("Blue liquid added to tube A");
        }
      } else {
        liquidA.setAttribute("visible", "true");
        liquidA.setAttribute("opacity", "0.95");
        console.log("Blue liquid already exists, making visible");
      }
      
      // BLUE SURFACE
      if (!surfaceA) {
        surfaceA = document.createElement("a-circle");
        surfaceA.setAttribute("id", "surfaceA");
        surfaceA.setAttribute("radius", "0.13");
        surfaceA.setAttribute("position", "0 0.28 0");
        surfaceA.setAttribute("color", "#0088ff");
        surfaceA.setAttribute("opacity", "0.95");
        surfaceA.setAttribute("rotation", "-90 0 0");
        surfaceA.setAttribute("visible", "true");
        
        const tubeA = document.querySelector("#tubeA");
        if (tubeA) {
          tubeA.appendChild(surfaceA);
          console.log("Blue surface added");
        }
      } else {
        surfaceA.setAttribute("visible", "true");
      }
      
      // YELLOW LIQUID
      let liquidB = document.querySelector("#liquidB");
      let surfaceB = document.querySelector("#surfaceB");
      
      if (!liquidB) {
        console.log("Creating yellow liquid...");
        liquidB = document.createElement("a-cylinder");
        liquidB.setAttribute("id", "liquidB");
        liquidB.setAttribute("radius", "0.13");
        liquidB.setAttribute("height", "0.10");
        liquidB.setAttribute("position", "0 0.05 0");
        liquidB.setAttribute("color", "#ffff00");
        liquidB.setAttribute("opacity", "0.95");
        liquidB.setAttribute("visible", "true");
        
        const tubeB = document.querySelector("#tubeB");
        if (tubeB) {
          tubeB.appendChild(liquidB);
          console.log("Yellow liquid added to tube B");
        }
      } else {
        liquidB.setAttribute("visible", "true");
        liquidB.setAttribute("opacity", "0.95");
        console.log("Yellow liquid already exists, making visible");
      }
      
      // YELLOW SURFACE
      if (!surfaceB) {
        surfaceB = document.createElement("a-circle");
        surfaceB.setAttribute("id", "surfaceB");
        surfaceB.setAttribute("radius", "0.13");
        surfaceB.setAttribute("position", "0 0.10 0");
        surfaceB.setAttribute("color", "#ffff00");
        surfaceB.setAttribute("opacity", "0.95");
        surfaceB.setAttribute("rotation", "-90 0 0");
        surfaceB.setAttribute("visible", "true");
        
        const tubeB = document.querySelector("#tubeB");
        if (tubeB) {
          tubeB.appendChild(surfaceB);
          console.log("Yellow surface added");
        }
      } else {
        surfaceB.setAttribute("visible", "true");
      }
      
      console.log("=== LIQUIDS SHOULD BE VISIBLE NOW ===");
      updateDebugInfo();
    }
    
    // SIMPLE MARKER TRACKING
    AFRAME.registerComponent("simple-marker", {
      schema: { id: { type: "string" } },
      
      init() {
        this.el.addEventListener("markerFound", () => {
          console.log(`Marker ${this.data.id} FOUND`);
          
          if (this.data.id === "A") {
            tubeAVisible = true;
            document.getElementById("status-a").textContent = "‚úÖ BLUE TUBE";
            document.getElementById("status-a").style.color = "#0088ff";
            
            // Force liquids visible after marker found
            setTimeout(forceLiquidsVisible, 500);
          }
          
          if (this.data.id === "B") {
            tubeBVisible = true;
            document.getElementById("status-b").textContent = "‚úÖ YELLOW TUBE";
            document.getElementById("status-b").style.color = "#ffff00";
            
            setTimeout(forceLiquidsVisible, 500);
          }
          
          updateStatus();
        });
        
        this.el.addEventListener("markerLost", () => {
          console.log(`Marker ${this.data.id} LOST`);
          
          if (this.data.id === "A") {
            tubeAVisible = false;
            document.getElementById("status-a").textContent = "‚ùå Not found";
            document.getElementById("status-a").style.color = "#ff4444";
          }
          
          if (this.data.id === "B") {
            tubeBVisible = false;
            document.getElementById("status-b").textContent = "‚ùå Not found";
            document.getElementById("status-b").style.color = "#ff4444";
          }
          
          updateStatus();
        });
      }
    });
    
    // SIMPLE DROPLET SYSTEM
    AFRAME.registerComponent("simple-drops", {
      init() {
        console.log("Simple drops system ready");
        
        // Tilt detection
        window.addEventListener("deviceorientation", (event) => {
          const tilt = Math.round(event.beta || 0);
          document.getElementById("tilt-info").textContent = `Tilt: ${tilt}¬∞`;
          
          // Create drops when tilted
          if (tilt > 30 && tubeAVisible && tubeBVisible) {
            this.createDrop();
          }
        });
        
        // Also allow button click
        document.getElementById("pour-btn").addEventListener("click", () => {
          this.createDrop();
        });
      },
      
      createDrop() {
        console.log("Creating drop...");
        
        // Create droplet
        const drop = document.createElement("a-sphere");
        drop.setAttribute("radius", "0.04");
        drop.setAttribute("color", "#0088ff");
        drop.setAttribute("opacity", "1");
        
        // Position at blue tube
        drop.setAttribute("position", "0 0.28 0");
        
        // Add to scene
        const scene = document.querySelector("a-scene");
        if (scene) {
          scene.appendChild(drop);
          
          // Animate falling
          let y = 0.28;
          const fall = setInterval(() => {
            y -= 0.02;
            drop.setAttribute("position", `0 ${y} 0`);
            
            if (y < -0.2) {
              clearInterval(fall);
              drop.parentNode.removeChild(drop);
            }
          }, 50);
        }
      }
    });
    
    // UPDATE STATUS
    function updateStatus() {
      const status = document.getElementById("experiment-status");
      if (tubeAVisible && tubeBVisible) {
        status.innerHTML = "<span style='color:#00ff00'>‚úÖ BOTH TUBES VISIBLE!</span><br>" +
                          "<span style='color:#0088ff'>Look for BLUE and YELLOW liquids</span>";
      } else if (tubeAVisible) {
        status.innerHTML = "<span style='color:#0088ff'>üîµ Blue tube found</span><br>" +
                          "<span style='color:#ffaa00'>Show yellow marker</span>";
      } else if (tubeBVisible) {
        status.innerHTML = "<span style='color:#ffff00'>üü° Yellow tube found</span><br>" +
                          "<span style='color:#ffaa00'>Show blue marker</span>";
      } else {
        status.innerHTML = "<span style='color:#ff4444'>üëÜ Show marker A or B</span>";
      }
    }
    
    // UPDATE DEBUG INFO
    function updateDebugInfo() {
      const debug = document.getElementById("debug-info");
      const liquidA = document.querySelector("#liquidA");
      const liquidB = document.querySelector("#liquidB");
      
      debug.innerHTML = `
        Liquid A: ${liquidA ? "‚úÖ Found" : "‚ùå Missing"}<br>
        Liquid B: ${liquidB ? "‚úÖ Found" : "‚ùå Missing"}<br>
        Tube A: ${tubeAVisible ? "‚úÖ" : "‚ùå"}<br>
        Tube B: ${tubeBVisible ? "‚úÖ" : "‚ùå"}
      `;
    }
    
    // FORCE VISIBLE BUTTON
    window.forceVisible = function() {
      console.log("=== MANUALLY FORCING VISIBILITY ===");
      forceLiquidsVisible();
      alert("Liquids forced visible! Check the tubes.");
    };
    
    // RESET BUTTON
    window.resetAll = function() {
      console.log("Resetting everything...");
      
      // Remove and recreate liquids
      const liquidA = document.querySelector("#liquidA");
      const surfaceA = document.querySelector("#surfaceA");
      const liquidB = document.querySelector("#liquidB");
      const surfaceB = document.querySelector("#surfaceB");
      
      if (liquidA) liquidA.parentNode.removeChild(liquidA);
      if (surfaceA) surfaceA.parentNode.removeChild(surfaceA);
      if (liquidB) liquidB.parentNode.removeChild(liquidB);
      if (surfaceB) surfaceB.parentNode.removeChild(surfaceB);
      
      // Recreate after delay
      setTimeout(forceLiquidsVisible, 100);
      
      // Reset HUD
      document.getElementById("tilt-info").textContent = "Tilt: 0¬∞";
      updateStatus();
      updateDebugInfo();
    };
    
    // Initialize
    window.onload = function() {
      console.log("=== PAGE LOADED ===");
      updateDebugInfo();
      
      // Try to force liquids after 2 seconds
      setTimeout(() => {
        console.log("Auto-forcing liquids visibility...");
        forceLiquidsVisible();
      }, 2000);
    };

  </script>

</head>

<body style="margin:0; overflow:hidden;">
  <!-- Simple HUD -->
  <div id="hud">
    <h3 style="margin: 0 0 10px 0; color: #00aaff;">üß™ SIMPLE CHEMICAL TEST</h3>
    <p><strong>Status:</strong> <span id="experiment-status">Show markers</span></p>
    <p><strong>Tilt:</strong> <span id="tilt-info">Tilt: 0¬∞</span></p>
    <p><strong>Markers:</strong><br>
      <span id="status-a" style="display:inline-block; margin:2px; padding:3px 8px; background:#222;">‚ùå Blue</span><br>
      <span id="status-b" style="display:inline-block; margin:2px; padding:3px 8px; background:#222;">‚ùå Yellow</span>
    </p>
    <button id="pour-btn" style="margin:5px; padding:8px; background:#0088ff; color:white; border:none; border-radius:5px;">
      üíß Create Drop
    </button>
    <button onclick="forceVisible()" style="margin:5px; padding:8px; background:#ff8800; color:white; border:none; border-radius:5px;">
      üî• Force Liquids
    </button>
    <button onclick="resetAll()" style="margin:5px; padding:8px; background:#ff4444; color:white; border:none; border-radius:5px;">
      üîÑ Reset All
    </button>
  </div>
  
  <!-- Debug Info -->
  <div id="debug-info" class="debug">
    Loading...
  </div>

  <!-- SIMPLE AR SCENE -->
  <a-scene
    embedded
    arjs="debugUIEnabled: false; sourceType: webcam;"
    renderer="colorManagement: true; alpha: true;"
    stats>

    <!-- Good lighting -->
    <a-light type="ambient" color="#ffffff" intensity="1.0"></a-light>
    <a-light type="directional" position="1 2 1" intensity="0.8"></a-light>

    <!-- ========== TEST TUBE A (BLUE) ========= -->
    <a-marker
      type="pattern"
      url="markers/testtube_markerA.patt"
      simple-marker="id: A"
      smooth="true"
      smoothCount="5"
      smoothTolerance="0.01">

      <a-entity id="tubeA" simple-drops position="0 0 0">
        <!-- Glass (VERY transparent) -->
        <a-cylinder
          radius="0.15"
          height="0.6"
          position="0 0.3 0"
          color="#ffffff"
          opacity="0.1"
          transparent="true"
          roughness="0.1"
          metalness="0.3">
        </a-cylinder>

        <!-- BLUE LIQUID WILL BE ADDED BY JAVASCRIPT -->
        <!-- This ensures it's created dynamically -->

      </a-entity>

    </a-marker>

    <!-- ========== TEST TUBE B (YELLOW) ========= -->
    <a-marker
      type="pattern"
      url="markers/testtube_markerB.patt"
      simple-marker="id: B"
      smooth="true"
      smoothCount="5"
      smoothTolerance="0.01">

      <a-entity id="tubeB" position="0 0 0">
        <!-- Glass -->
        <a-cylinder
          radius="0.15"
          height="0.6"
          position="0 0.3 0"
          color="#ffffff"
          opacity="0.1"
          transparent="true"
          roughness="0.1"
          metalness="0.3">
        </a-cylinder>

        <!-- YELLOW LIQUID WILL BE ADDED BY JAVASCRIPT -->

      </a-entity>

    </a-marker>

    <!-- Camera -->
    <a-entity camera></a-entity>

  </a-scene>
  
  <!-- SIMPLE INSTRUCTIONS -->
  <div style="position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); 
              background: rgba(0,0,0,0.95); color: white; padding: 15px; 
              border-radius: 10px; text-align: center; max-width: 95%; z-index: 1000;
              border: 3px solid #00ff88;">
    <h4 style="margin: 0 0 10px 0;">üéØ SIMPLE STEPS:</h4>
    <p style="margin: 5px 0; color: #0088ff;">1. Show <strong>BLUE marker</strong> (look for blue liquid)</p>
    <p style="margin: 5px 0; color: #ffff00;">2. Show <strong>YELLOW marker</strong> (look for yellow liquid)</p>
    <p style="margin: 5px 0; color: #00ff88;">3. If liquids not visible ‚Üí Click <strong>üî• FORCE LIQUIDS</strong></p>
    <p style="margin: 5px 0; color: #ffaa00;">4. Click <strong>üíß CREATE DROP</strong> or tilt phone</p>
    <p style="margin: 10px 0 0 0; font-size: 12px; color: #aaa;">
      <strong>Debug info at bottom-left</strong> | Check browser console (F12)
    </p>
  </div>
  
  <!-- Emergency console button -->
  <button onclick="showConsoleHelp()" 
          style="position: absolute; top: 50%; right: 10px; 
                 background: #333; color: white; padding: 10px;
                 border: none; border-radius: 5px; font-size: 12px;">
    üÜò Console Help
  </button>
  
  <script>
    function showConsoleHelp() {
      console.clear();
      console.log("=== EMERGENCY CONSOLE COMMANDS ===");
      console.log("1. Check if liquids exist:");
      console.log("   document.querySelector('#liquidA')");
      console.log("   document.querySelector('#liquidB')");
      console.log("");
      console.log("2. Manually create liquids:");
      console.log("   forceVisible();");
      console.log("");
      console.log("3. Check marker visibility:");
      console.log("   console.log('Tube A visible:', tubeAVisible);");
      console.log("   console.log('Tube B visible:', tubeBVisible);");
      console.log("");
      console.log("4. Force create drop:");
      console.log("   document.querySelector('#pour-btn').click();");
      console.log("================================");
      
      alert("Check browser console (F12) for emergency commands!");
    }
  </script>
</body>
</html>
